<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>os.Pipe</title>
      <link rel="stylesheet" href="../../resources/css/styles.css" />
      <link rel="stylesheet" href="../../resources/css/codeblock.css" />
   </head>
   <body>
      <div class="question"><strong>1. What is os.Pipe?</strong></div>
      <div class="answer">
         <ul>
            <li>It is used for inter process communication;</li>
            <li>It creates unidirectional pipe that enables communication between parent and child processes;</li>
            <li>It returns a pair of connected *os.File objects: a read end and a write end;</li>
            <li>Anything written to the write end of the pipe can be read from the read end;</li>
            <li>Data actually flows through the kernel (like a Unix pipe) - slower;</li>
         </ul>
      </div>

      <div class="code-block">
         <div class="code-block-title">os-pipe-1.go</div>
         <button class="copy-btn">Copy</button>
         <pre><code>package main

import (
	"fmt"
	"os"
	"os/exec"
)

func main() {
	// Create the pipe (for stdout of echo â†’ stdin of grep)
	r, w, err := os.Pipe()
	if err != nil {
		panic(err)
	}

	// First command: echo "hello world"
	echoCmd := exec.Command("echo", "hello world")
	echoCmd.Stdout = w // Output of the command is written to the write end of the pipe

	// Second command: grep "hello"
	grepCmd := exec.Command("grep", "hello")
	grepCmd.Stdin = r // grepCmd takes input from read end of the pipe

	// output of grepCmd is redirected to stdout
	grepCmd.Stdout = os.Stdout

	// Start echo
	if err := echoCmd.Start(); err != nil {
		panic(err)
	}

	// Start grep
	if err := grepCmd.Start(); err != nil {
		panic(err)
	}

	// Close parent's copies (important!)
	w.Close()
	r.Close()

	// Wait for both processes
	if err := echoCmd.Wait(); err != nil {
		panic(err)
	}
	if err := grepCmd.Wait(); err != nil {
		panic(err)
	}

	fmt.Println("Pipeline finished successfully")
}

<b>Output:</b>
hello world
Pipeline finished successfully

</code></pre>
      </div>

<br/>
            <div class="code-block">
         <div class="code-block-title">wg-2.go</div>
         <button class="copy-btn">Copy</button>
         <pre><code>package main

import (
    "fmt"
    "os"
)

func main() {
    r, w, _: = os.Pipe()

    go func() {
        defer w.Close()
        w.Write([] byte("hello from os.Pipe"))
    }()

    buf: = make([] byte, 64)
    n, _: = r.Read(buf)
    fmt.Println(string(buf[: n])) // "hello from os.Pipe"
}

<b>Output:</b>
hello from os.Pipe

</code></pre>
      </div>


      <script src="../../resources/js/codeblock.js"></script>
   </body>
</html>